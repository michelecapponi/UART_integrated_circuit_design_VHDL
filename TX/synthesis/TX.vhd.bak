library ieee;
use ieee.std_logic_1164.all;

entity TX is
port (
		clk: in std_logic;
		rst_n: in std_logic;
		enable_tx: in std_logic;
		load: in std_logic;
		tx_empty: out std_logic;
		dato_tx: in std_logic_vector(7 downto 0);
		TxD: out std_logic
     );
end entity;

architecture rtl of TX is

COMPONENT datapath IS PORT(
		clk: in std_logic;
		rst_n: in std_logic;
		p_in : in std_logic_vector(7 downto 0);
		parallel_load : in std_logic;
		sh	: in std_logic;
		TxD	: out std_logic;
		enable_139, enable_10: in std_logic;
		tc_139, tc_10: out std_logic
		);
END COMPONENT;

COMPONENT fsm IS PORT(
			TC_139, TC_10, RST_N, CLK, load, enable_tx : IN STD_LOGIC;
			sh, parallel_load, enable_139, enable_10, reset_n_datapath, TX_EMPTY: OUT STD_LOGIC
			);
END COMPONENT;

SIGNAL parallel_load, enable_139, enable_10, sh, TC_139, TC_10, reset_n_datapath: std_logic;  --segnali interni che collegano datapath a fsm

begin

label_datapath: datapath PORT MAP(clk=>clk, rst_n=>reset_n_datapath, p_in=>dato_tx, parallel_load=>parallel_load, sh=>sh, TxD=>TxD, enable_139=>enable_139, enable_10=>enable_10, tc_139=>tc_139, tc_10=>tc_10);

label_fsm: fsm PORT MAP(tc_139=>tc_139, tc_10=>tc_10, RST_N=>rst_n, CLK=>clk, load=>load, enable_tx=>enable_tx, sh=>sh, parallel_load=>parallel_load, enable_139=>enable_139, enable_10=>enable_10, reset_n_datapath=>reset_n_datapath,TX_EMPTY=>TX_EMPTY);


END rtl;